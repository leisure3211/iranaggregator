<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IRAN TENSION MONITOR v11.1 ‚Äî RESILIENT PROXY</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <link rel="icon" href="data:,">
<style>
:root {
  --bg: #0f1923; --panel: #162030; --panel-dark: #0d1520;
  --border: #253a52; --text: #d4e6f8; --text-dim: #8899aa; --bright: #ffffff;
  --accent: #29b6f6; --danger: #f44336; --warn: #ffa726; --green: #4caf50;
  --purple: #ab47bc;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px; background: var(--bg); color: var(--text); }
#header { height: 42px; background: #0a1218; border-bottom: 2px solid var(--accent); display: flex; align-items: center; padding: 0 12px; gap: 10px; flex-shrink: 0; z-index: 300; }
.logo { font-size: 16px; font-weight: 700; color: #fff; }
.badge { background: #29b6f618; border: 1px solid var(--accent); color: var(--accent); padding: 2px 7px; border-radius: 3px; font-size: 11px; }
#ticker { flex: 1; font-size: 12px; color: var(--warn); overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
#clock { font-size: 14px; color: var(--accent); font-family: 'Courier New', monospace; }
.live-dot { width: 7px; height: 7px; background: var(--danger); border-radius: 50%; animation: blink 1s infinite; flex-shrink: 0; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }
.collapse-btn { position: absolute; top: 8px; right: 8px; z-index: 10; background: rgba(10,18,24,0.8); border: 1px solid var(--border); color: var(--text-dim); padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 11px; }
.sidebar.collapsed { width: 40px; }
.sidebar.collapsed .section, .sidebar-right.collapsed .tab-pane { display: none; }
#main { display: flex; height: calc(100vh - 42px); }
.sidebar, .sidebar-right { background: var(--panel-dark); overflow-y: auto; display: flex; flex-direction: column; flex-shrink: 0; position: relative; transition: width 0.3s ease; }
.sidebar { width: 270px; border-right: 1px solid var(--border); }
.sidebar-right { width: 340px; border-left: 1px solid var(--border); }
#center { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
#map-wrap { height: 50%; position: relative; border-bottom: 2px solid var(--accent); }
#map { height: 100%; width: 100%; }
#news-center { flex: 1; display: flex; flex-direction: column; background: var(--panel-dark); }
#news-center-header { height: 36px; background: #0a1218; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 12px; gap: 10px; flex-shrink: 0; }
.nc-title { font-size: 12px; font-weight: 700; color: var(--accent); }
.nc-count { font-family: 'Courier New', monospace; font-size: 11px; color: var(--green); margin-left: auto; }
#news-stream { flex: 1; overflow-y: auto; }
.error-message, .big-red-error { padding: 60px 20px; text-align: center; color: #fff; font-size: 18px; font-weight: 700; background: var(--danger); border: 4px solid #b71c1c; margin: 20px; border-radius: 8px; line-height: 1.4; }
.big-red-error { font-size: 22px; }
.ns-item { display: flex; gap: 10px; padding: 8px 12px; border-bottom: 1px solid #162030; cursor: pointer; align-items: flex-start; }
.ns-item:hover { background: #122035; }
.ns-item.MILITARY { border-left: 3px solid var(--warn); }
.ns-source-logo { width: 36px; height: 36px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; color: #fff; flex-shrink: 0; text-align: center; }
.ns-body { flex: 1; min-width: 0; }
.ns-meta { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }
.ns-source-name { font-size: 10px; font-weight: 700; color: var(--text-dim); }
.ns-time { font-size: 10px; font-family: 'Courier New', monospace; color: var(--text-dim); }
.ns-cat { font-size: 9px; padding: 1px 5px; border-radius: 2px; font-weight: 700; }
.ns-cat.MILITARY { background: #ffa72620; color: var(--warn); }
.ns-headline { font-size: 12px; font-weight: 600; color: var(--bright); }
.section { border-bottom: 1px solid var(--border); padding: 9px 11px; }
.sec-title { font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--accent); margin-bottom: 7px; }
.stat-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #1a2d40; font-size: 13px; }
.stat-row .lbl { color: var(--text-dim); }
.stat-row .val { font-family: 'Courier New', monospace; font-weight: 700; }
#risk-wrap { text-align: center; padding: 4px 0 2px; }
#risk-wrap svg { transform: rotate(-90deg); }
#ring-bg { fill: none; stroke: #1e3048; stroke-width: 10; }
#ring-fill { fill: none; stroke-width: 10; stroke-linecap: round; stroke: var(--danger); transition: stroke-dashoffset 1.5s; }
#risk-num { font-size: 26px; font-weight: 700; color: var(--danger); }
#risk-sub { font-size: 10px; color: var(--text-dim); }
.risk-badge { text-align: center; padding: 3px; border-radius: 3px; font-size: 11px; font-weight: 700; margin-bottom: 7px; background: #f4433618; border: 1px solid var(--danger); color: var(--danger); }
.btn { background: transparent; border: 1px solid var(--accent); color: var(--accent); padding: 5px 10px; border-radius: 3px; font-size: 11px; cursor: pointer; width: 100%; margin-top: 5px; }
.btn:disabled { opacity: 0.5; }
#map-controls { position: absolute; top: 8px; left: 8px; z-index: 500; display: flex; flex-direction: column; gap: 4px; }
.map-btn { background: rgba(10,18,24,0.9); border: 1px solid var(--border); color: var(--text); padding: 4px 10px; border-radius: 3px; font-size: 11px; cursor: pointer; }
.map-btn.active { background: #29b6f612; border-color: var(--accent); color: var(--accent); }
.tab-bar { display: flex; background: #0a1218; border-bottom: 1px solid var(--border); flex-shrink: 0; }
.tab { flex: 1; padding: 7px 3px; text-align: center; font-size: 10px; font-weight: 700; cursor: pointer; color: var(--text-dim); border-bottom: 2px solid transparent; }
.tab.active { color: var(--accent); border-bottom-color: var(--accent); }
.tab-pane { display: none; overflow-y: auto; padding: 9px 11px; flex: 1; }
.tab-pane.active { display: block; }
#tab-briefing, #tab-osintlab { font-size: 11px; }
#tab-briefing h3, #tab-osintlab h3 { font-size: 14px; color: var(--accent); margin: 12px 0 6px 0; border-bottom: 1px solid var(--border); padding-bottom: 4px; }
#tab-briefing p { color: var(--text-dim); }
#tab-briefing a { color: var(--accent); }
#methodTable table { width:100%;border-collapse:collapse; }
#methodTable th, #methodTable td { padding: 4px 6px; border: 1px solid var(--border); text-align: left; }
.kri-row { display: flex; align-items: center; gap: 7px; padding: 4px 0; border-bottom: 1px solid #1a2d40; }
.kri-icon { font-size: 15px; width: 22px; text-align: center; }
.kri-lbl { display: flex; justify-content: space-between; font-size: 10px; color: var(--text-dim); }
.kri-bar-bg { height: 4px; background: #1a2d40; border-radius: 3px; }
.kri-bar-fill { height: 100%; border-radius: 3px; transition: width 0.5s ease-out; }
#bottom-bar { height: 30px; background: #0a1218; border-top: 1px solid var(--border); display: flex; align-items: center; overflow: hidden; }
.tick { padding: 0 12px; font-size: 10px; font-family: 'Courier New', monospace; color: var(--text-dim); border-right: 1px solid var(--border); }
.tick .wn { color: var(--warn); }
.leaflet-container { background: #0d1a28 !important; }
.leaflet-popup-content-wrapper, .leaflet-popup-tip { background: #162030; border: 1px solid var(--border); color: var(--text); }
.emoji-marker { font-size: 18px; line-height: 1; filter: drop-shadow(0 0 3px rgba(41,182,246,0.6)); }
.emoji-marker.tanker { font-size: 24px; filter: drop-shadow(0 0 5px rgba(255,112,67,0.9)); }
.marker-cluster-small { background-color: rgba(41, 182, 246, 0.6); }
.marker-cluster-medium { background-color: rgba(41, 182, 246, 0.8); }
.marker-cluster-large { background-color: rgba(41, 182, 246, 1.0); }
.marker-cluster { background-clip: padding-box; border-radius: 20px; color: #fff; font-weight: bold; text-align: center; font-family: 'Courier New', monospace; }
.marker-cluster div { width: 30px; height: 30px; margin-left: 5px; margin-top: 5px; text-align: center; border-radius: 15px; font: 12px bold; }
.marker-cluster span { line-height: 30px; }
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: #0a1218; }
::-webkit-scrollbar-thumb { background: #253a52; }
</style>
</head>
<body>

<div id="header">
  <div class="logo">üåç IRAN TENSION MONITOR</div>
  <div class="badge">v11.1 RESILIENT</div>
  <div class="live-dot"></div>
  <div id="ticker">ATTEMPTING PURE REAL-TIME FEEDS...</div>
  <div id="clock"></div>
</div>

<div id="main">
  <div class="sidebar" id="leftSidebar">
      <button class="collapse-btn" onclick="toggleSidebar('left')">‚óÄ</button>
      <div class="section">
        <div class="sec-title">Risk Index</div>
        <div id="risk-wrap">
          <svg width="110" height="110" viewBox="0 0 110 110"><circle id="ring-bg" cx="55" cy="55" r="44"/><circle id="ring-fill" cx="55" cy="55" r="44" stroke-dasharray="276.5"/></svg>
          <div style="margin-top:-65px;margin-bottom:34px"><div id="risk-num">0%</div><div id="risk-sub">Threat Level</div></div>
        </div>
        <div id="risk-badge" class="risk-badge">ANALYZING...</div>
      </div>
      <div class="section">
        <div class="sec-title">Live Assets</div>
        <div class="stat-row"><span class="lbl">‚úàÔ∏è Aircraft</span><span class="val" id="aircraftCount">0</span></div>
        <div class="stat-row"><span class="lbl">‚õΩ Tankers</span><span class="val" id="tankerCount">0</span></div>
        <div class="stat-row"><span class="lbl">‚öì US Carriers</span><span class="val" id="carrierCount">0</span></div>
        <button class="btn" id="scanBtn" onclick="runScan(true)" disabled>‚ö° SCAN</button>
      </div>
  </div>

  <div id="center">
      <div id="map-wrap"><div id="map"></div>
        <div id="map-controls">
          <button class="map-btn active" onclick="toggleLayer(this,'mil')">‚úàÔ∏è Aircraft</button>
          <button class="map-btn active" onclick="toggleLayer(this,'naval')">üö¢ Naval</button>
          <button class="map-btn active" onclick="toggleLayer(this,'sites')">‚ò¢Ô∏è Sites</button>
        </div>
      </div>
      <div id="news-center">
        <div id="news-center-header"><div class="nc-title">üì° OSINT STREAM</div><div id="nc-count" class="nc-count"></div></div>
        <div id="news-stream"></div>
      </div>
      <div id="bottom-bar"><div class="tick">OSINT SIGNALS: <span id="osint-signal-count" class="wn">0</span></div></div>
  </div>

  <div class="sidebar-right" id="rightSidebar">
    <button class="collapse-btn" onclick="toggleSidebar('right')">‚ñ∂</button>
    <div class="tab-bar">
      <div class="tab active" onclick="showTab(this,'kri')">üéØ KRI</div>
      <div class="tab" onclick="showTab(this,'briefing')">üìñ Briefing</div>
      <div class="tab" onclick="showTab(this,'osintlab')">üõ†Ô∏è OSINT Lab</div>
    </div>
    <div class="tab-pane active" id="tab-kri"></div>
    <div class="tab-pane" id="tab-briefing"></div>
    <div class="tab-pane" id="tab-osintlab">
      <input type="text" id="methodSearch" placeholder="Filter signals..." style="width:100%;padding:8px;margin:8px 0;background:#0d1a28;border:1px solid var(--border);color:var(--text);">
      <div id="methodTable" style="max-height:calc(100vh - 220px);overflow:auto;font-size:11px;"></div>
    </div>
  </div>
</div>

<script>
// ==================== CONFIG & GLOBALS ====================
const NEWS_API_KEY = "efe3bda118f94631bd30780ba36c5983";
const OSINT_METHODS = [
    {ID:'M0001', D:'Maritime', T:'Dark Ship Detection', W: 3},
    {ID:'M0002', D:'Imagery', T:'Change Detection', W: 5},
    {ID:'M0003', D:'Aviation', T:'Tanker Surge', W: 4},
];
const EMAP = { fighter:'‚úàÔ∏è', tanker:'‚õΩ', cargo:'üì¶', awacs:'üì°', drone:'üõ∏', helicopter:'üöÅ', recon:'üëÅÔ∏è', bomber:'üõ©Ô∏è', stealth:'üëª', transport:'üöê', uav:'üõ∞Ô∏è', maritime:'‚öì' };
let allNews = [], allAircraft = [], scanning = false;

// ==================== DOM & UTILITIES ====================
const el = (id) => document.getElementById(id);
const showTab = (tabEl, name) => {
    document.querySelectorAll('.tab.active, .tab-pane.active').forEach(e => e.classList.remove('active'));
    tabEl.classList.add('active');
    el('tab-' + name).classList.add('active');
}
const toggleSidebar = (side) => el(side+'Sidebar').classList.toggle('collapsed');

// ==================== MAP & LAYERS =====================
const map = L.map('map', { zoomControl: false }).setView([28, 56], 5);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: 'CartoDB' }).addTo(map);
const aircraftClusterGroup = L.markerClusterGroup({
  chunkedLoading: true,
  spiderfyOnMaxZoom: true,
  showCoverageOnHover: true,
  zoomToBoundsOnClick: true
});
aircraftClusterGroup.addTo(map);
const LAYERS = { mil: aircraftClusterGroup, naval: L.layerGroup().addTo(map), sites: L.layerGroup().addTo(map) };

const toggleLayer = (btn, name) => {
    const layer = LAYERS[name];
    if (!layer) return;
    btn.classList.toggle('active');
    if (map.hasLayer(layer)) map.removeLayer(layer); else map.addLayer(layer);
}

function buildStaticLayers() {
    [{ lat: 33.7, lon: 51.7, name: 'Natanz' }, { lat: 34.9, lon: 48.8, name: 'Fordow' }].forEach(s =>
        L.marker([s.lat, s.lon], { icon: L.divIcon({ html: '‚ò¢Ô∏è', className: 'emoji-marker'}) }).addTo(LAYERS.sites).bindPopup(`<b>${s.name}</b>`)
    );
    L.marker([25.0, 58.0], { icon: L.divIcon({ html: '‚öì', className: 'emoji-marker'}) }).addTo(LAYERS.naval).bindPopup('<b>USS Lincoln</b>');
    el('carrierCount').textContent = "1";
}

// ==================== MULTI-PROXY (RESILIENT) ====================
async function fetchWithProxy(targetUrl) {
    const proxyFns = [
        async (u) => fetch(`https://cors.sh/${u.replace(/^https?:\/\//, '')}`, { headers: { 'x-cors-api-key': 'temp_1234567890' } }).then(res => res.json()),
        async (u) => fetch(`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`).then(res => res.json()),
        async (u) => {
            const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(u)}`);
            const wrapper = await res.json();
            if (wrapper && wrapper.contents) return JSON.parse(wrapper.contents);
            throw new Error('Invalid allorigins.win response');
        }
    ];

    for (const proxyFn of proxyFns) {
        try {
            const data = await proxyFn(targetUrl);
            return data; // Success
        } catch (e) {
            console.warn(`A proxy failed for ${targetUrl}: ${e.message}`);
            // This error is expected when a proxy is down, so we just try the next one.
        }
    }

    console.error(`All proxies failed for ${targetUrl}.`);
    return null; // Return null if all proxies fail
}

// ==================== CORE SCANNING (DUAL-SOURCE) ====================
async function runScan(isManual = false) {
    if (scanning && !isManual) return;
    scanning = true;
    el('scanBtn').disabled = true;
    el('ticker').textContent = "‚ö° SCANNING AIRCRAFT FEEDS...";

    if (isManual) {
        await fetchAndRenderNews();
    }

    const adsbLolPromise = fetchWithProxy('https://api.adsb.lol/v2/mil');
    const openSkyPromise = fetchWithProxy('https://opensky-network.org/api/states/all?lamin=22&lamax=41&lomin=44&lomax=73');

    const [adsbData, openSkyData] = await Promise.all([adsbLolPromise, openSkyPromise]);

    let mergedAircraft = [];

    if (adsbData && adsbData.ac && adsbData.ac.length > 0) {
        const adsbAircraft = adsbData.ac.map(a => ({...a, type: a.t || 'fighter'})).filter(a => a.lat && a.lon);
        mergedAircraft.push(...adsbAircraft);
    }

    if (openSkyData && openSkyData.states && openSkyData.states.length > 0) {
        const openSkyAircraft = openSkyData.states.filter(s => s[6] && s[5]).map(s => ({
            lat: s[6], lon: s[5], hex: s[0], gs: s[9], alt: s[7], type: 'fighter'
        }));
        mergedAircraft.push(...openSkyAircraft);
    }
    
    const aircraftMap = new Map();
    mergedAircraft.forEach(ac => {
        if (!aircraftMap.has(ac.hex) || (aircraftMap.get(ac.hex).type === 'fighter' && ac.type !== 'fighter')) {
            aircraftMap.set(ac.hex, ac);
        }
    });

    allAircraft = Array.from(aircraftMap.values());

    if (allAircraft.length === 0) {
        el('ticker').innerHTML = `<span style="color:#f44336;font-weight:700">üö® AIRCRAFT FEED FAILED ‚Äî ALL PROXIES EXHAUSTED OR APIs DOWN</span>`;
    }
    
    renderAircraft();
    updateRiskAndUI();

    scanning = false;
    el('scanBtn').disabled = false;
}

// ==================== UI RENDERING ======================

function renderAircraft() {
    aircraftClusterGroup.clearLayers();
    allAircraft.forEach(ac => {
        const e = EMAP[ac.type] || '‚úàÔ∏è';
        const big = ac.type === 'tanker' || ac.type === 'bomber' || ac.type === 'cargo';
        const marker = L.marker([ac.lat, ac.lon], {
            icon: L.divIcon({
                html: `<div class="emoji-marker${big ? ' tanker' : ''}">${e}</div>`,
                className: '',
                iconSize: [big ? 24 : 20, big ? 24 : 20]
            })
        });
        marker.bindPopup(`<b>${e} ${(ac.type || 'AIRCRAFT').toUpperCase()}</b> ¬∑ ${ac.hex}<br><small>${ac.gs||'?'} kt ¬∑ ${(ac.alt||0).toLocaleString()} ft</small>`);
        marker.addTo(aircraftClusterGroup);
    });
    el('aircraftCount').textContent = allAircraft.length;
    el('tankerCount').textContent = allAircraft.filter(a => a.type === 'tanker').length;
}

async function fetchAndRenderNews() {
    const ticker = el('ticker');
    const newsStreamEl = el('news-stream');
    const ncCountEl = el('nc-count');
    
    ticker.textContent = "‚ö° PULLING NEWSAPI...";
    ncCountEl.textContent = "";

    const url = `https://newsapi.org/v2/everything?q=(iran OR tehran OR IRGC OR hezbollah)&apiKey=${NEWS_API_KEY}&language=en&sortBy=publishedAt&pageSize=40`;
    const data = await fetchWithProxy(url);

    if (data && data.status === 'ok' && data.articles && data.articles.length > 0) {
        allNews = data.articles.map(article => ({
            title: article.title, link: article.url, source: article.source.name,
            timeAgo: new Date(article.publishedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
            category: /strike|missile|attack|war|conflict/i.test(article.title) ? 'MILITARY' : ''
        }));
        renderNewsUI();
    } else {
        newsStreamEl.innerHTML = `<div class="big-red-error">üö® NEWSAPI FEED FAILED<br><br>ALL PROXIES BLOCKED OR NEWSAPI FREE TIER RESTRICTIONS<br><br>Real data unavailable from browser. SCAN to retry.</div>`;
        ncCountEl.textContent = "ERROR";
        ticker.innerHTML = `<span style="color:#f44336">üö® NEWS FEED FAILED ‚Äî PROXIES EXHAUSTED</span>`;
        allNews = [];
    }
    return true;
}

function renderNewsUI() {
    const newsStreamEl = el('news-stream');
    const ncCountEl = el('nc-count');
    
    newsStreamEl.innerHTML = allNews.map(item => {
        const initials = (item.source || "").replace(/[^A-Z]/g, '').substring(0,2) || "N";
        return `<div class="ns-item ${item.category}" onclick="window.open('${item.link}','_blank')">
            <div class="ns-source-logo" style="background:#162030;">${initials}</div>
            <div class="ns-body">
                <div class="ns-meta"><span class="ns-source-name">${item.source}</span><span class="ns-time">${item.timeAgo}</span></div>
                <div class="ns-headline">${item.title}</div>
            </div>
        </div>`;
    }).join('');
    
    ncCountEl.textContent = `${allNews.length} LIVE`;
    if (allNews.length > 0) {
        el('ticker').innerHTML = `üö® <span style="color:#ff7043">LIVE:</span> ${allNews[0].title.substring(0, 55)}...`;
    }
}

function buildOSINTLab(filter = '') {
    const filtered = OSINT_METHODS.filter(m => Object.values(m).some(v => v.toString().toLowerCase().includes(filter.toLowerCase())));
    el('methodTable').innerHTML = `<table><thead><tr><th>ID</th><th>D</th><th>T</th><th>W</th></tr></thead><tbody>${filtered.map(m=>`<tr><td>${m.ID}</td><td>${m.D}</td><td>${m.T}</td><td>${m.W}</td></tr>`).join('')}</tbody></table>`;
}

function updateRiskAndUI() {
    const tankerScore = allAircraft.filter(a => a.type === 'tanker').length;
    const totalRisk = Math.min(99, 15 + (tankerScore * 5));
    
    el('risk-num').textContent = `${Math.round(totalRisk)}%`;
    const ring = el('ring-fill');
    if (ring && ring.r && ring.r.baseVal) {
        const r = ring.r.baseVal.value;
        ring.style.strokeDashoffset = (r * 2 * Math.PI) * (1 - totalRisk / 100);
    }

    el('risk-badge').textContent = totalRisk > 70 ? "HIGH ALERT" : totalRisk > 40 ? "ELEVATED" : "NOMINAL";
    el('osint-signal-count').textContent = OSINT_METHODS.length + tankerScore;
    el('tab-kri').innerHTML = `<div class="kri-row"><div class="kri-icon">‚õΩ</div><div class="kri-body"><div class="kri-lbl"><span>Tanker Orbits</span><span class="kri-status">${tankerScore} ACTIVE</span></div><div class="kri-bar-bg"><div class="kri-bar-fill" style="width:${Math.min(100, tankerScore*20)}%; background:var(--danger)"></div></div></div></div>`;
}

// ==================== INITIALIZATION ====================
window.addEventListener('load', () => {
  try {
    setInterval(() => { el('clock').textContent = new Date().toLocaleTimeString('en-US', { timeZone: 'UTC', hour12: false }) + ' UTC'; }, 1000);
    buildStaticLayers();
    buildOSINTLab();
    el('methodSearch').addEventListener('input', (e) => buildOSINTLab(e.target.value));
    el('tab-briefing').innerHTML = `<h3>OSINT Summary</h3><p>Fusing multiple open-source intel streams to monitor geopolitical tensions.</p><h4>Core Methods</h4><ul><li><b>IMINT:</b> Imagery analysis</li><li><b>SIGINT:</b> Aircraft & Naval tracking</li><li><b>SOCMINT:</b> Social media & news</li></ul><a href="https://www.bellingcat.com/" target="_blank">Learn More ‚Üí</a>`;
    
    el('scanBtn').disabled = false;
    runScan(true);                              // first pure real attempt
    setInterval(() => runScan(false), 180000);  // aircraft every 3 min
    setInterval(fetchAndRenderNews, 300000);    // news every 5 min

  } catch (e) {
    console.error("Critical Initialization failed:", e);
    document.body.innerHTML = `<div style="color:#f44336;padding:80px;font-size:24px;text-align:center">CRITICAL ERROR ‚Äî CHECK CONSOLE</div>`;
  }
});
</script>
</body>
</html>
